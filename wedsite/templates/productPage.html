{% extends 'index.html' %}

{% block content %}
<section class="content-main">
    <div class="card">
        <div class="card-body">
            <div class="row gx-5">
                <aside class="col-lg-2 border-end">
                    <nav class="nav nav-pills flex-lg-column mb-4">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" data-filter="all" style="text-align: left;">All</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" data-filter="men" style="text-align: left;">Men's Wear</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" data-filter="women" style="text-align: left;">Women's Wear</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" data-filter="boys" style="text-align: left;">Boy's Wear</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" data-filter="girls" style="text-align: left;">Girl's Wear</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" data-filter="kids" style="text-align: left;">Kid's Wear</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" data-filter="newBorn" style="text-align: left;">New Born</button>
                        </li>
                    </nav>
                </aside>
                <div class="col-lg-9">
                    <div class="row" id="product-container">
                        {% for item in items %}
                        <div class="col-md-3 product-item" data-category="{{ item.product_tag }}">
                            <div class="product-cart-wrap hover-up" style="margin-left: 25px;">
                                <div class="product-img-action-wrap index-img">
                                    <div class="xzoom-container">
                                        <a href="#">
                                            <img class="xzoom" src="{{ item.product_picture }}" xoriginal="{{ item.product_picture }}" alt="">
                                        </a>
                                    </div>
                                    <div class="product-action-1">
                                        <a aria-label="Quick view" class="action-btn hover-up" data-bs-toggle="modal" data-bs-target="#quickViewModal{{ item.id }}"><i class="fi-rs-eye"></i></a>
                                            <i class="fi-rs-heart"></i>
                                        </a>
                                    </div>
                                    <div class="product-badges product-badges-position product-badges-mrg">
                                        <span class="hot">Hot</span>
                                    </div>
                                </div>
                                <div class="product-content-wrap">
                                    <div class="product-category">
                                        <a href="shop-grid-right.html">{{ item.product_tag }}</a>
                                    </div>
                                    <h2><a href="#">{{ item.product_name }}</a></h2>
                                    <div class="rating-result" title="90%">
                                        <span></span>
                                    </div>
                                    <div class="product-price">
                                        <span>₹ {{ item.single_product_price }}</span>
                                    </div>
                                    <div class="product-action-1 show">
                                        <a aria-label="For Enquiry" class="action-btn hover-up"
                                            href="https://api.whatsapp.com/send?phone=1234567890">
                                            <i class="fab fa-whatsapp fa-lg" style="font-size:24px;"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- PopUp Menu to select the product -->
                        <div class="modal fade custom-modal" id="quickViewModal{{ item.id }}" tabindex="-1" aria-labelledby="quickViewModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">              
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>       
                                    <div class="modal-body">
                                        <div class="row">
                                            <div class="col-md-6 col-sm-12 col-xs-12">
                                                <div class="detail-gallery">
                                                    <span class="zoom-icon"><i class="fi-rs-search"></i></span>
                                                    <!-- MAIN SLIDES -->
                                                    <div class="product-image-slider">
                                                        <figure class="border-radius-10">
                                                            <img src="{{ item.product_picture_zoom }}" alt="product image">
                                                        </figure>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 col-sm-12 col-xs-12">
                                                <div class="detail-info">
                                                    <h3 class="title-detail mt-30">{{ item.product_name }}</h3>
                                                    <div class="product-detail-rating">
                                                        <div class="pro-details-brand">
                                                            <span> Brand: <a href="shop-grid-right.html">{{ item.brand_name }}</a></span>
                                                        </div>
                                                        <div class="product-rate-cover text-end">
                                                            <span class="font-small ml-5 text-muted">Model # {{ item.product_code }}</span>
                                                        </div>
                                                    </div>
                                                    <div class="clearfix product-price-cover">
                                                        <div class="product-price primary-color float-left">
                                                            <ins><span class="text-brand">₹ {{ item.single_product_price }}</span></ins>
                                                            <!-- <span class="save-price font-md color3 ml-15" style="color: red;">Upto 75% Off</span> -->
                                                        </div>
                                                    </div>
                                                    <div class="bt-1 border-color-1 mt-15 mb-5"></div>
                                                    <div class="short-desc mb-5">
                                                        <p class="font-sm mr-10">{{ item.about_product }}</p>
                                                    </div>

                                                    <div class="short-desc mb-30">
                                                        <strong class="mr-15" style="font-size: 30px;">Pack of<span class="in-stock text ml-5" style="color: #2f515a;">{{ item.no_of_products }}</span> pcs</strong>
                                                    
                                                    </div>
                                                    
                                                    <div class="bt-1 border-color-1 mt-5 mb-5"></div>
                                                    <div class="attr-detail attr-size">
                                                        <strong class="mr-10">Avilable Size</strong>
                                                        <ul class="list-filter size-filter font-small">
                                                            <li><a href="#">S:{{ item.product_sizes_no_for_s }}</a></li>
                                                            <li><a href="#">M:{{ item.product_sizes_no_for_m }}</a></li>
                                                            <li><a href="#">L:{{ item.product_sizes_no_for_l }}</a></li>
                                                            <li><a href="#">XL:{{ item.product_sizes_no_for_xl }}</a></li>
                                                            <li><a href="#">XXL:{{ item.product_sizes_no_for_xxl }}</a></li>
                                                        </ul>
                                                    </div>
                                                    <br>
                                                    <div class="clearfix product-price-cover">
                                                        <div class="product-price primary-color float-left">
                                                            <ins><span class="text-brand">₹ {{ item.no_of_products_price }}</span></ins>
                                                            <!-- <span class="save-price font-md color3 ml-15" style="color: red;">Upto 75% Off</span> -->
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="bt-1 border-color-1 mt-20 mb-5"></div>
                                                    <div class="detail-extralink">
                                                        <div class="detail-qty border radius">
                                                            <a href="#" class="qty-down"><i class="fi-rs-angle-small-down"></i></a>
                                                            <span class="qty-val">1</span>
                                                            <a href="#" class="qty-up"><i class="fi-rs-angle-small-up"></i></a>
                                                        </div>
                                                        <div class="product-extra-link2">
                                                            <button type="submit" class="button add-to-wishlist-btn" data-product-id="{{ item.id }}" data-product-type="{{ item.product_type }}">Add to cart</button>
                                                        </div>
                                                    </div>
                                                    
                                                    <ul class="product-meta font-xs color-grey mt-15">
                                                        <li class="mb-5">Tags: <a href="#" rel="tag" style="color: #3ed092;">Cloth</a>, <a href="#" rel="tag" style="color: #3ed092;">{{ item.product_tag }}</a>, <a href="#" rel="tag" style="color: #3ed092;">Dress</a> </li>
                                                        <li>Availability:<span class="in-stock text-success ml-5">Surpluse Stock</span></li>
                                                    </ul>
                                                </div>
                                                <!-- Detail Info -->
                                            </div>
                                        </div>
                                    </div>        
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <hr class="my-5">
                </div> <!-- col.// -->
            </div> <!-- row.// -->
        </div> <!-- card body end// -->
    </div> 
</section> 

<style>
    .nav-pills .nav-link {
        font-size: 20px;
        width: 100%;
    }
    
    .nav-pills .nav-link:hover {
        background-color: #2f515a; /* Change background color on hover */
    }
    
    .product-cart-wrap {
        position: relative;
        border: 2px solid #b9cace; /* Add black border */
        border-radius: 15px; /* Add border-radius for rounded corners */
        padding: 10px; /* Optional: Add padding inside the border */
    }
    
    .product-img-action-wrap img {
        display: block;
        max-width: 100%;
        height: auto;
        border: 2px solid #b9cace; /* Add black border around the image */
        border-radius: 15px; /* Add border-radius for rounded corners */
    }
    </style>
    

<script>
    document.addEventListener('DOMContentLoaded', function () {
    var addToWishlistButtons = document.querySelectorAll('.add-to-wishlist-btn');

    addToWishlistButtons.forEach(function (button) {
        button.addEventListener('click', function (event) {
            event.preventDefault();
            var productId = button.getAttribute('data-product-id');
            var productType = button.getAttribute('data-product-type'); // Add data-product-type attribute
            var qtyValElement = button.closest('.detail-extralink').querySelector('.qty-val');
            var quantity = parseInt(qtyValElement.textContent);

            fetch('/check_login_status', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.is_logged_in) {
                    var endpoint;
                    if (productType === 'ProductPage') {
                        endpoint = `/add_to_cart/${productId}`;
                    } else if (productType === 'Product') {
                        endpoint = `/add_product_newArrival/${productId}`;
                    } else if (productType === 'BestSeller') {
                        endpoint = `/add_product_bestSeller/${productId}`;
                    } else {
                        alert('Invalid product type');
                        return;
                    }

                    fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token() }}'
                        },
                        body: JSON.stringify({
                            product_id: productId,
                            quantity: quantity
                        })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            alert(data.message + ' Quantity: ' + data.quantity);
                        } else {
                            alert('Failed to add product to cart: ' + data.message);
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
                } else {
                    window.location.href = '/userLogin';
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    });

    // Quantity increment/decrement handlers
    var qtyDownButtons = document.querySelectorAll('.qty-down');
    var qtyUpButtons = document.querySelectorAll('.qty-up');

    qtyDownButtons.forEach(function (button) {
        button.addEventListener('click', function (event) {
            event.preventDefault();
            var qtyValElement = button.nextElementSibling;
            var currentQty = parseInt(qtyValElement.textContent);
            if (currentQty > 1) {
                qtyValElement.textContent = currentQty - 1;
            }
        });
    });

    qtyUpButtons.forEach(function (button) {
        button.addEventListener('click', function (event) {
            event.preventDefault();
            var qtyValElement = button.previousElementSibling;
            var currentQty = parseInt(qtyValElement.textContent);
            qtyValElement.textContent = currentQty + 1;
        });
    });
});


</script>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        var filterButtons = document.querySelectorAll('.nav-link');
        var productItems = document.querySelectorAll('.product-item');

        filterButtons.forEach(function (button) {
            button.addEventListener('click', function () {
                var filterValue = button.getAttribute('data-filter');
                filterProducts(filterValue);
            });
        });

        function filterProducts(category) {
            productItems.forEach(function (item) {
                var itemCategory = item.getAttribute('data-category');

                if (category === 'all' || category === itemCategory) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
    });
</script>
<script src="../static/js/vendor/jquery-3.6.0.min.js"></script>
<script src="../static/js/vendor/bootstrap.bundle.min.js"></script>
<script src="../static/js/plugins/select2.min.js"></script>
<script src="../static/js/plugins/perfect-scrollbar.js"></script>

<!-- Main Script -->
<script src="static/js/main.js" type="text/javascript"></script>

{% endblock %}
